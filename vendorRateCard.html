<template>
    <div style="display: none;">{recordId}</div>

    <!-- ========== SCREEN 1: EDIT PRICING ========== -->
    <template if:true={showFirstScreen}>
        <lightning-card>
            <lightning-record-edit-form object-api-name="Vendor_Rate_Card__c" density="comfy">
                <lightning-messages></lightning-messages>
                <lightning-layout>
                    <lightning-layout-item flexibility="auto">
                        <lightning-input-field field-name="Project_Price_Book__c" value={recordId} ></lightning-input-field>
                    </lightning-layout-item>
                    <lightning-layout-item flexibility="auto" padding="horizontal-small">
                        <lightning-input-field field-name="Vendor_Account__c" data-id="vendorAccount" value={vendorAccount} onchange={handleVendorAccountChange}></lightning-input-field>
                    </lightning-layout-item>
                    <lightning-layout-item flexibility="auto no-grow">
                        <lightning-input-field field-name="Payment_Terms__c" data-id="paymentTerms" value={paymentTerms} onchange={handlePaymentTermsChange}></lightning-input-field>
                    </lightning-layout-item>
                    <lightning-layout-item flexibility="auto" padding="horizontal-small">
                        <lightning-input-field field-name="Link_to_Contract__c" value={contractUrl} ></lightning-input-field>
                    </lightning-layout-item>
                    <lightning-layout-item flexibility="auto no-grow" size=1>
                        <lightning-input label="OU" value={vendorAccountOu} disabled></lightning-input>
                    </lightning-layout-item>
                </lightning-layout>
            </lightning-record-edit-form>

            <!-- HEADER TEXT AREA -->
            <lightning-layout>
                <lightning-layout-item flexibility="auto">
                    <div class="section-header">
                        <p class="section-title">Add Rates to Vendor Rate Card</p>
                        <p>Enter vendor pricing below and click "Review Rates" to continue.</p>
                    </div>
                </lightning-layout-item>

                <!-- Search bar for table  -->
                <lightning-layout-item flexibility="auto">
                    <br>
                    <lightning-input type="search" label="Search" variant="label-hidden" placeholder="Search Price Book Items..." onchange={handleSearch}></lightning-input>
                </lightning-layout-item>
            </lightning-layout>


            <div class="slds-scrollable sticky-table-container" style="height:800px;">
            <table class="slds-table">
                <thead class="slds-text-title_caps sticky-header">
                    <tr>
                        <th>Price Book Item</th>
                        <th>Description</th>
                        <th>UOM</th>
                        <th>Price Per Unit</th>
                        <th>Ext. Labor Cost</th>
                        <th>Vendor Rate</th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={filteredPricingRecords} for:item="record">
                        <tr key={record.priceBookItemId} class={record.rowClass}>
                            <td class="slds-truncate" style="max-width: 200px;"><a href=#>{record.priceBookItemName}</a></td>
                            <td class="slds-truncate description-cell" style="max-width: 300px;">{record.description}</td>
                            <td>{record.uom}</td>
                            <td><lightning-formatted-number value={record.pricePerUnit} format-style="currency" currency-code="USD"></lightning-formatted-number></td>
                            <td><lightning-formatted-number value={record.externalLaborCost} format-style="currency" currency-code="USD"></lightning-formatted-number></td>
                            <td class={record.rowClass}>
                                <lightning-input
                                    type="number"
                                    variant="label-hidden"
                                    class="my-input"
                                    step="any"
                                    formatter="currency"
                                    value={record.congruexVendorPrice}
                                    data-id={record.priceBookItemId}
                                    onchange={handleVendorRateChange}>
                                </lightning-input>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
            </div>
            <!-- <div class="results-container">
                <lightning-datatable
                    key-field="priceBookItemId"
                    data={pricingRecords}
                    columns={columns}
                    draft-values={draftValues}
                    onsave={handleDraftSave}
                    oncellchange={handleCellChange}
                    suppress-bottom-bar>
                </lightning-datatable>
            </div> -->

            <!-- FOOTER BUTTON BAR -->
            <div slot="footer" class="footer-button-bar">
                <lightning-button label="Cancel" onclick={handleCancel} class="slds-m-horizontal_x-small"></lightning-button>
                <lightning-button label="Review Rates" variant="brand" onclick={goToReview} class="slds-m-horizontal_x-small"></lightning-button>
                <!-- <lightning-button label="Save Rates" variant="brand" onclick={saveRates} class="slds-m-horizontal_x-small"></lightning-button> -->
            </div>
        </lightning-card>
    </template>

    <!-- ========== SCREEN 2: CONFIRMATION SCREEN ========== -->
    <template if:true={showSecondScreen}>
        <lightning-card title="Confirm Vendor Rates" icon-name="custom:custom14">
            <div class="slds-m-around_small">
                <p>Please review the vendor rates below, then click "Save Rates" to create a Vendor Rate Card.</p>
                <br/>
                <div class="results-container">
                    <lightning-datatable
                        key-field="priceBookItemId"
                        data={editedRatePreview}
                        columns={columns}
                        draft-values={draftValues}
                        oncellchange={handleCellChange}
                        onsave={handleDraftSave}
                        hide-checkbox-column>
                    </lightning-datatable>
                </div>
            </div>
            <!-- FOOTER NAVIGATION -->
            <div slot="footer" class="footer-button-bar">
                <lightning-button
                    label="Back"
                    onclick={goBack}
                    class="slds-m-horizontal_x-small">
                </lightning-button>
                <lightning-button
                    label="Save Rates"
                    variant="brand"
                    onclick={saveRates}
                    class="slds-m-horizontal_x-small">
                </lightning-button>
            </div>
        </lightning-card>
    </template>

    <!-- ========== SCREEN 3: SUCCESS CONFIRMATION ========== -->
    <template if:true={showConfirmationScreen}>
        <lightning-card title="Vendor Rate Card Created" icon-name="action:approval">
            <!-- <div style="font-size: 16px;"><lightning-icon icon-name="utility:success" variant="success" size="small" class="slds-p-horizontal_small"></lightning-icon>Vendor Rate Card Created</div> -->
            <div class="slds-m-around_small">
                <p>The Vendor Rate Card has been successfully created.</p>
            </div>
            <p class="slds-m-top_small">
                <!-- <strong>Rate Card Name:</strong> -->
                <a href={vendorRateCardName} target="_blank">{vendorRateCardName}</a>
            </p>
            <p class="slds-m-top_medium slds-text-title_bold">Created Vendor Pricing Records: ({countOfEditedRows})</p>
            <table class="slds-table slds-table_cell-buffer slds-m-top_small">
                <thead class="slds-text-title_caps sticky-header">
                    <tr>
                        <th>Congruex Vendor Pricing ID</th>
                        <th>Price Book Item</th>
                        <th>Description</th>
                        <th>UOM</th>
                        <th>Vendor Rate</th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={createdRecords} for:item="rec">
                        <tr key={rec.congruexVendorPricingId}>
                            <td><a href=#>{rec.congruexVendorPricingName}</a></td>
                            <td>{rec.priceBookItemName}</td>
                            <td>{rec.description}</td>
                            <td>{rec.uom}</td>
                            <td><lightning-formatted-number value={rec.congruexVendorPrice} format-style="currency" currency-code="USD"></lightning-formatted-number></td>
                        </tr>
                    </template>
                </tbody>
            </table>

            <!-- FOOTER BUTTON BAR -->
            <div slot="footer" class="footer-button-bar">
                <lightning-button
                    label="Close"
                    onclick={handleCloseConfirmation}
                    class="slds-m-horizontal_x-small"
                    variant="brand">
                </lightning-button>
            </div>
        </lightning-card>
    </template>

</template>
